<p>This project provides CSV parsing and has been tested and used 
on large input files.</p>

<ul>
  <li>Follow the Node.js streaming API</li>
  <li>Async and event based</li>
  <li>Support delimiters, quotes, escape characters and comments</li>
  <li>Line breaks discovery: detected in source and reported to destination</li>
  <li>Data transformation</li>
  <li>Support for large datasets</li>
  <li>Complete test coverage as sample and inspiration</li>
  <li>no external dependencies</li>
</ul>

<p>Important: this documentation covers the current version (0.2.x) of 
<code class="highlighter-rouge">node-csv-parser</code>. The documentation for the previous version (0.1.0) is 
available <a href="https://github.com/wdavidw/node-csv-parser/tree/v0.1">here</a>.</p>

<h2 id="installation">Installation</h2>

<p><code class="highlighter-rouge">bash
npm install csv
</code></p>

<h2 id="quick-example">Quick example</h2>

<p>This take a string with a comment and convert it to an array:</p>

<p>```javascript</p>

<p>// node samples/string.js
csv()
.from.string(
  ‘#Welcome\n”1”,”2”,”3”,”4”\n”a”,”b”,”c”,”d”’,
  {comment: ‘#’} )
.to.array( function(data){
  console.log(data)
} );
// [ [ ‘1’, ‘2’, ‘3’, ‘4’ ], [ ‘a’, ‘b’, ‘c’, ‘d’ ] ]</p>

<p>```</p>

<h2 id="advanced-example">Advanced example</h2>

<p>The following example illustrates 4 usages of the library:
1.  Plug a readable stream from a file
2.  Direct output to a file path
3.  Transform each row
4.  Listen to events</p>

<p>```javascript</p>

<p>// node samples/sample.js
var csv = require(‘csv’);
var fs = require(‘fs’);
csv()
.from.stream(fs.createReadStream(__dirname+’/sample.in’))
.to.path(__dirname+’/sample.out’)
.transform( function(row){
  row.unshift(row.pop());
  return row;
})
.on(‘record’, function(row,index){
  console.log(‘#’+index+’ ‘+JSON.stringify(row));
})
.on(‘end’, function(count){
  console.log(‘Number of lines: ‘+count);
})
.on(‘error’, function(error){
  console.log(error.message);
});
// #0 [“2000-01-01”,”20322051544”,”1979.0”,”8.8017226E7”,”ABC”,”45”]
// #1 [“2050-11-27”,”28392898392”,”1974.0”,”8.8392926E7”,”DEF”,”23”]
// Number of lines: 2</p>

<p>```</p>

<h2 id="pipe-example">Pipe example</h2>

<p>The module follow a Stream architecture. At its core, the parser and 
the stringifier utilities provide a <a href="http://nodejs.org/api/stream.html#stream_writable_stream">Stream Writer</a> 
and a <a href="http://nodejs.org/api/stream.html#stream_readable_stream">Stream Reader</a> implementation available in the CSV API.</p>

<p>```javascript</p>

<p>+——–+      +———-+———-+       +——–+
|        |      |          |          |       |        |
|        |      |         CSV         |       |        |
|        |      |          |          |       |        |
| Stream |      |  Writer  |  Reader  |       | Stream |
| Reader |.pipe(|   API    |   API    |).pipe(| Writer |)
|        |      |          |          |       |        |
|        |      |          |          |       |        |
+——–+      +———-+———-+       +——–+</p>

<p>```</p>

<p>Here’s a quick example:</p>

<p>```javascript</p>

<p>in = fs.createReadStream(‘./in’)
out = fs.createWriteStream(‘./out’)
in.pipe(csv()).pipe(out)</p>

<p>```</p>

<h2 id="installing">Installing</h2>

<p>Via <a href="http://github.com/isaacs/npm">npm</a>:
<code class="highlighter-rouge">bash
npm install csv
</code></p>

<p>Via git (or downloaded tarball):
<code class="highlighter-rouge">bash
git clone http://github.com/wdavidw/node-csv-parser.git
</code></p>

<h2 id="events">Events</h2>

<p>The library extends Node <a href="http://nodejs.org/api/events.html">EventEmitter</a> class and emit all
the events of the Writable and Readable <a href="http://nodejs.org/api/stream.html">Stream API</a>. Additionally, the useful “records” event 
is emitted.</p>

<ul>
  <li><em>record</em> <br />
  Emitted by the stringifier when a new row is parsed and transformed. The data is 
  the value returned by the user <code class="highlighter-rouge">transform</code> callback if any. Note however that the event won’t 
  be called if <code class="highlighter-rouge">transform</code> returns <code class="highlighter-rouge">null</code> since the record is skipped.
  The callback provides two arguments. <code class="highlighter-rouge">row</code> is the CSV line being processed (an array or an object)
  and <code class="highlighter-rouge">index</code> is the index number of the line starting at zero</li>
  <li><em>data</em> <br />
  Emitted by the stringifier on each line once the data has been transformed and stringified.</li>
  <li><em>drain</em></li>
  <li><em>end</em> <br />
  Emitted when the CSV content has been parsed.</li>
  <li><em>finish</em> <br />
  Emitted when all data has been flushed to the underlying system. For example, when writting to a file with <code class="highlighter-rouge">csv().to.path()</code>, the event will be called once the writing process is complete and the file closed.</li>
  <li><em>error</em> <br />
  Thrown whenever an error occured.</li>
</ul>

<h2 id="architecture">Architecture</h2>

<p>The code is organized mainly around 5 main components. 
The “from” properties provide convenient functions 
to write CSV text or to plug a Stream Reader. The “parser” 
takes this CSV content and transform it into an array or 
an object for each line. The “transformer” provides the ability 
to work on each line in a synchronous or asynchronous mode. 
The “stringifier” takes an array or an object and serializes it into 
CSV text. Finally, the “to” properties provide convenient 
functions to retrieve the text or to write to plug a Stream Writer.</p>

<p>```javascript</p>

<p>+——-+——–+————–+————–+—–+
|       |        |              |              |     |
| from -&gt; parser -&gt; transformer -&gt; stringifier -&gt; to |
|       |        |              |              |     |
+——-+——–+————–+————–+—–+</p>

<p>```</p>

<p>Note, even though the “parser”, “transformer” and “singifier” are available
as properties, you won’t have to interact with those.</p>

<p><a name="pause"></a>
<code class="highlighter-rouge">pause()</code>
———</p>

<p>Implementation of the Readable Stream API, requesting that no further data 
be sent until resume() is called.</p>

<p><a name="resume"></a>
<code class="highlighter-rouge">resume()</code>
———-</p>

<p>Implementation of the Readable Stream API, resuming the incoming ‘data’ 
events after a pause().</p>

<p><a name="write"></a>
<code class="highlighter-rouge">write(data, [preserve])</code>
————————-</p>

<p>Implementation of the Writable Stream API with a larger signature. Data
may be a string, a buffer, an array or an object.</p>

<p>If data is a string or a buffer, it could span multiple lines. If data 
is an object or an array, it must represent a single line.
Preserve is for line which are not considered as CSV data.</p>

<p><a name="end"></a>
<code class="highlighter-rouge">end()</code>
——-</p>

<p>Terminate the parsing. Call this method when no more csv data is 
to be parsed. It implement the StreamWriter API by setting the <code class="highlighter-rouge">writable</code> 
property to “false” and emitting the <code class="highlighter-rouge">end</code> event.</p>

<p><a name="transform"></a>
<code class="highlighter-rouge">transform(callback, [options])</code>
———————</p>

<p>Register the transformer callback. The callback is a user provided 
function call on each line to filter, enrich or modify the 
dataset. More information in the “transforming data” section.</p>

<p><a name="error"></a>
<code class="highlighter-rouge">error(error)</code>
————–</p>

<p>Unified mechanism to handle error, emit the error and mark the 
stream as non readable and non writable.</p>

